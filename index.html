<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Acompanhamento de Saúde</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">Painel de Saúde</h1>
            <p class="text-lg text-gray-600 mt-2">Acompanhe seu progresso de forma visual e intuitiva.</p>
        </header>

        <!-- Seção de Inserção de Dados -->
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2">Novo Registro</h2>
            <form id="data-form" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <div class="flex flex-col">
                    <label for="date" class="mb-1 font-medium text-gray-700">Data</label>
                    <input type="date" id="date" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="flex flex-col">
                    <label for="weight" class="mb-1 font-medium text-gray-700">Peso (kg)</label>
                    <input type="number" step="0.1" id="weight" placeholder="Ex: 75.5" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="flex flex-col">
                    <label for="bodyfat" class="mb-1 font-medium text-gray-700">Gordura Corporal (%)</label>
                    <input type="number" step="0.1" id="bodyfat" placeholder="Ex: 18.2" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex flex-col">
                    <label for="muscle" class="mb-1 font-medium text-gray-700">Massa Muscular (kg)</label>
                    <input type="number" step="0.1" id="muscle" placeholder="Ex: 35.2" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex flex-col">
                    <label for="glucose" class="mb-1 font-medium text-gray-700">Glicose (mg/dL)</label>
                    <input type="number" id="glucose" placeholder="Ex: 90" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex flex-col">
                    <label for="systolic" class="mb-1 font-medium text-gray-700">Pressão Sistólica</label>
                    <input type="number" id="systolic" placeholder="Ex: 120" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex flex-col">
                    <label for="diastolic" class="mb-1 font-medium text-gray-700">Pressão Diastólica</label>
                    <input type="number" id="diastolic" placeholder="Ex: 80" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex items-end md:col-span-3 lg:col-span-1">
                    <button type="submit" class="w-full bg-blue-600 text-white font-semibold p-2.5 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">Adicionar Registro</button>
                </div>
            </form>
        </div>

        <!-- Gráficos -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-lg card">
                <h3 class="text-xl font-semibold mb-4 text-center">Peso (kg)</h3>
                <div class="chart-container">
                    <canvas id="weightChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-lg card">
                <h3 class="text-xl font-semibold mb-4 text-center">Composição Corporal (%)</h3>
                <div class="chart-container">
                    <canvas id="compositionChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-lg card">
                <h3 class="text-xl font-semibold mb-4 text-center">Glicose (mg/dL)</h3>
                <div class="chart-container">
                    <canvas id="glucoseChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-lg card">
                <h3 class="text-xl font-semibold mb-4 text-center">Pressão Arterial (mmHg)</h3>
                <div class="chart-container">
                    <canvas id="pressureChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tabela de Histórico -->
        <div class="bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Histórico de Registros</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="p-3 font-semibold text-gray-600">Data</th>
                            <th class="p-3 font-semibold text-gray-600">Peso</th>
                            <th class="p-3 font-semibold text-gray-600">Gordura %</th>
                            <th class="p-3 font-semibold text-gray-600">Músculo %</th>
                            <th class="p-3 font-semibold text-gray-600">Glicose</th>
                            <th class="p-3 font-semibold text-gray-600">Pressão</th>
                            <th class="p-3 font-semibold text-gray-600">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="history-table">
                        <!-- Linhas de dados serão inseridas aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO INICIAL ---
        const form = document.getElementById('data-form');
        const tableBody = document.getElementById('history-table');

        // Carrega dados do localStorage ou inicializa um array vazio
        let healthData = JSON.parse(localStorage.getItem('healthData')) || [];

        // --- FUNÇÕES DE LÓGICA ---

        // Função para formatar a data para exibição (dd/mm/aaaa)
        const formatDate = (dateString) => {
            const [year, month, day] = dateString.split('-');
            return `${day}/${month}/${year}`;
        };

        // Função para renderizar a tabela de histórico
        const renderTable = () => {
            tableBody.innerHTML = ''; // Limpa a tabela antes de renderizar
            // Ordena os dados por data, do mais recente para o mais antigo
            const sortedData = [...healthData].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-4 text-gray-500">Nenhum registro encontrado. Adicione um novo para começar.</td></tr>`;
                return;
            }
            
            sortedData.forEach((data, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';

                // Aplica formatação condicional
                const weightCellClass = getWeightClass(data.weight, sortedData[index + 1]?.weight);
                const glucoseCellClass = getGlucoseClass(data.glucose);
                const pressureCellClass = getPressureClass(data.systolic, data.diastolic);

                // Calcula o percentual de massa muscular
                const musclePercent = (data.muscle && data.weight) ? ((data.muscle / data.weight) * 100).toFixed(1) + '%' : 'N/A';

                row.innerHTML = `
                    <td class="p-3">${formatDate(data.date)}</td>
                    <td class="p-3 ${weightCellClass}">${data.weight || 'N/A'}</td>
                    <td class="p-3">${data.bodyfat ? data.bodyfat + '%' : 'N/A'}</td>
                    <td class="p-3">${musclePercent}</td>
                    <td class="p-3 ${glucoseCellClass}">${data.glucose || 'N/A'}</td>
                    <td class="p-3 ${pressureCellClass}">${data.systolic && data.diastolic ? `${data.systolic}/${data.diastolic}` : 'N/A'}</td>
                    <td class="p-3"><button onclick="deleteEntry('${data.id}')" class="text-red-500 hover:text-red-700 font-semibold">Excluir</button></td>
                `;
                tableBody.appendChild(row);
            });
        };

        // --- FUNÇÕES DE FORMATAÇÃO CONDICIONAL ---
        const getWeightClass = (current, previous) => {
            if (!current || !previous) return '';
            if (current < previous) return 'text-green-600 font-medium';
            if (current > previous) return 'text-red-600 font-medium';
            return '';
        };

        const getGlucoseClass = (glucose) => {
            if (!glucose) return '';
            if (glucose < 70) return 'text-blue-600 font-medium'; // Hipoglicemia
            if (glucose >= 70 && glucose <= 99) return 'text-green-600 font-medium'; // Normal
            if (glucose >= 100 && glucose <= 125) return 'text-yellow-600 font-medium'; // Pré-diabetes
            if (glucose > 125) return 'text-red-600 font-medium'; // Diabetes
            return '';
        };

        const getPressureClass = (systolic, diastolic) => {
            if (!systolic || !diastolic) return '';
            if (systolic < 120 && diastolic < 80) return 'text-green-600 font-medium'; // Ótima
            if (systolic <= 129 && diastolic <= 84) return 'text-green-700 font-medium'; // Normal
            if (systolic <= 139 || diastolic <= 89) return 'text-yellow-600 font-medium'; // Limítrofe
            if (systolic >= 140 || diastolic >= 90) return 'text-red-600 font-medium'; // Hipertensão
            return '';
        };

        // --- LÓGICA DOS GRÁFICOS ---
        let charts = {};
        const createOrUpdateCharts = () => {
             // Ordena os dados por data para os gráficos
            const chartData = [...healthData].sort((a, b) => new Date(a.date) - new Date(b.date));
            const labels = chartData.map(d => formatDate(d.date));

            const chartConfigs = {
                weightChart: {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Peso (kg)',
                            data: chartData.map(d => d.weight),
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    }
                },
                compositionChart: {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Gordura Corporal (%)',
                            data: chartData.map(d => d.bodyfat),
                            borderColor: '#F97316',
                            backgroundColor: 'rgba(249, 115, 22, 0.1)',
                            fill: true,
                            tension: 0.3
                        }, {
                            label: 'Massa Muscular (%)',
                            // Calcula o percentual de massa muscular para o gráfico
                            data: chartData.map(d => (d.muscle && d.weight) ? (d.muscle / d.weight) * 100 : null),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    }
                },
                glucoseChart: {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Glicose (mg/dL)',
                            data: chartData.map(d => d.glucose),
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    }
                },
                pressureChart: {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Sistólica (mmHg)',
                            data: chartData.map(d => d.systolic),
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            fill: false,
                            tension: 0.3
                        }, {
                            label: 'Diastólica (mmHg)',
                            data: chartData.map(d => d.diastolic),
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: false,
                            tension: 0.3
                        }]
                    }
                }
            };

            for (const chartId in chartConfigs) {
                const ctx = document.getElementById(chartId).getContext('2d');
                if (charts[chartId]) {
                    charts[chartId].destroy();
                }
                charts[chartId] = new Chart(ctx, {
                    ...chartConfigs[chartId],
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    // Adiciona o símbolo de % no eixo Y do gráfico de composição
                                    callback: function(value, index, values) {
                                        if (chartId === 'compositionChart') {
                                            return value + '%';
                                        }
                                        return value;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        };

        // --- MANIPULADORES DE EVENTOS ---

        // Adicionar novo registro
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newEntry = {
                id: Date.now().toString(), // ID único para cada entrada
                date: document.getElementById('date').value,
                weight: parseFloat(document.getElementById('weight').value) || null,
                bodyfat: parseFloat(document.getElementById('bodyfat').value) || null,
                muscle: parseFloat(document.getElementById('muscle').value) || null, // Agora em kg
                glucose: parseInt(document.getElementById('glucose').value) || null,
                systolic: parseInt(document.getElementById('systolic').value) || null,
                diastolic: parseInt(document.getElementById('diastolic').value) || null
            };

            healthData.push(newEntry);
            localStorage.setItem('healthData', JSON.stringify(healthData));
            
            renderTable();
            createOrUpdateCharts();
            form.reset();
            // Define a data de hoje no campo de data após o reset
            document.getElementById('date').valueAsDate = new Date();
        });

        // Excluir um registro
        window.deleteEntry = (id) => {
            healthData = healthData.filter(entry => entry.id !== id);
            localStorage.setItem('healthData', JSON.stringify(healthData));
            renderTable();
            createOrUpdateCharts();
        };
        
        // --- INICIALIZAÇÃO DA PÁGINA ---
        document.addEventListener('DOMContentLoaded', () => {
            // Define a data de hoje no campo de data ao carregar
            document.getElementById('date').valueAsDate = new Date();
            renderTable();
            createOrUpdateCharts();
        });

    </script>
</body>
</html>
